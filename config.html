{% extends "base.html" %}
	
{% block title %}{{ application_name }} Конфигурация системы {% endblock %}

{% block head %}
  <link type="text/css" rel="stylesheet" href="stylesheets/ui.all.css" />
  <style type="text/css">{% include "css/config.css" %}

input.digits {
	text-align: right;
}

input.compl {
	//color: green;
	text-align: right;
	font-weight: bold;
	background: lime;
}

form table tr th{
	font-size: 0.9em;
}

</style>

<script type="text/javascript">
userconfigs = {}
function ChangeParam(me)
{
	userconfigs[me.id] = me.value;
	userstr = ""
	for (userconfig in userconfigs){
		userstr += userconfig + "="+ userconfigs[userconfig] + ";";
	}
	$("#userconfig").html(userstr.replace(/_/g,"."));
	//$(me).style("text-align: left;");
	me.className = "compl";
}

	$(function() {
		$("#dialog").dialog("destroy");
		$("#dialog-modal").dialog({
			height: 140,
			modal: true,
			autoOpen: false,
			buttons: {
				'Да, я уверен.': function() {
					var imei = $("#imei").html();
					$.getJSON("/system?cmd=del&imei=" + imei, function (data) {
						window.location = "/";
					});
					$(this).dialog('close');
				},
				Cancel: function() {
					$(this).dialog('close');
				}
			}
		});
	});

		function dodel(imei) {
		// a workaround for a flaw in the demo system (http://dev.jqueryui.com/ticket/4375), ignore!
			$("#imei").html(imei);
			$("#dialog-modal").dialog('open');
	
		}

</script>

{% endblock %}

{% block body %}
	<h2>Наблюдаемые системы:</h2>
	<table>
		<tr>
			<th>IMEI</th>
			<th>Номер телефона</th>
			<th>Описание</th>
			<th title="Карта">M</th>
			<th title="Конфигурация">C</th>
			<th title="Удаление">X</th>
		</tr>
        {% for user in users %}
		<tr>
			<td>{{ user.imei }}</td>
			<td>{{ user.phone }}</td>
			<td style="text-align: left;">{{ user.desc }}</td>
			<td><a class="smallButton" href="map?imei={{ user.imei }}" title="Посмотреть положение системы">M</a></td>
			<td><a class="smallButton" href="config?imei={{ user.imei }}" title="Изменить параметры системы">С</a></td>
			<td><a class="smallButton" href="javascript:dodel({{ user.imei }});" title="Отказаться от слежения за этой системой">X</a></td>
		</tr>
	{% endfor %}

	</table>

	<div id="dialog-modal" title="Внимание!!!">
		<p>Вы действительно хотите отказаться от слежения за системой?</p>
		<div id="imei">111</div>
	</div>

	<div style="border: none; text-align:left; padding: 2px 2px 2px 2px;">
	<a class="smallButton" href="firmware" title="Обновление внутреннего программного обеспечения системы.">U</a>
	</div>
{% endblock %}

{% block final %}
{% endblock %}
